<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Barbearia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 2rem; }
        .agendamento-card { margin-bottom: 1rem; }
        .agendamento-data { font-weight: bold; font-size: 1.1rem; }
        .agendamento-hora { color: #555; }
        .agendamento-barbeiro { color: #007bff; font-weight: bold; }
    </style>
</head>
<body>
    <h2 class="mb-4">Barbearia</h2>

    <!-- Adicionar Cliente -->
    <div class="mb-4">
        <h4>Adicionar Cliente</h4>
        <input type="text" id="nome" placeholder="Nome" class="form-control mb-2">
        <input type="text" id="telefone" placeholder="Telefone" class="form-control mb-2">
        <button id="btn-cliente" class="btn btn-primary">Adicionar Cliente</button>
    </div>

    <!-- Adicionar Agendamento -->
    <div class="mb-4">
        <h4>Adicionar Agendamento</h4>
        <input type="text" id="cliente-ag" placeholder="Nome do Cliente" class="form-control mb-2">
        <input type="text" id="data" placeholder="Data (dd/mm/aaaa)" class="form-control mb-2">
        <input type="text" id="hora" placeholder="Hora" class="form-control mb-2">
        <input type="text" id="barbeiro" placeholder="Barbeiro" class="form-control mb-2">
        <button id="btn-agendamento" class="btn btn-success">Adicionar Agendamento</button>
    </div>

    <!-- Filtrar Agendamentos -->
    <div class="mb-4">
        <h5>Filtrar Agendamentos</h5>
        <input type="text" id="filtro-barbeiro" placeholder="Filtrar por barbeiro" class="form-control mb-2">
        <input type="text" id="filtro-data" placeholder="Filtrar por data (dd/mm/aaaa)" class="form-control mb-2">
        <button id="btn-filtrar" class="btn btn-warning">Aplicar Filtro</button>
    </div>

    <!-- Lista de Agendamentos -->
    <h4>Agendamentos Futuros</h4>
    <div id="lista-agendamentos" class="mt-3"></div>

<script>
const API = "";

document.getElementById("btn-cliente").addEventListener("click", async ()=>{
    const nome = document.getElementById("nome").value;
    const telefone = document.getElementById("telefone").value;
    const formData = new FormData();
    formData.append("nome", nome);
    formData.append("telefone", telefone);
    const res = await fetch(`${API}/clientes`, {method:"POST", body: formData});
    const data = await res.json();
    alert(data.msg);
    document.getElementById("nome").value = "";
    document.getElementById("telefone").value = "";
});

document.getElementById("btn-agendamento").addEventListener("click", async ()=>{
    const nome_cliente = document.getElementById("cliente-ag").value;
    const data_agendamento = document.getElementById("data").value;
    const hora = document.getElementById("hora").value;
    const barbeiro = document.getElementById("barbeiro").value;

    const formData = new FormData();
    formData.append("nome_cliente", nome_cliente);
    formData.append("data_agendamento", data_agendamento);
    formData.append("hora", hora);
    formData.append("barbeiro", barbeiro);

    const res = await fetch(`${API}/agendamentos`, {method:"POST", body: formData});
    const data = await res.json();
    alert(data.msg);

    document.getElementById("cliente-ag").value = "";
    document.getElementById("data").value = "";
    document.getElementById("hora").value = "";
    document.getElementById("barbeiro").value = "";

    carregarAgendamentos();
});

document.getElementById("btn-filtrar").addEventListener("click", carregarAgendamentos);

async function carregarAgendamentos(){
    const barbeiro = document.getElementById("filtro-barbeiro").value;
    const data = document.getElementById("filtro-data").value;
    let url = `${API}/agendamentos/futuros?`;
    if(barbeiro) url += `filtrar_barbeiro=${barbeiro}&`;
    if(data) url += `filtrar_data=${data}&`;

    const res = await fetch(url);
    const agendamentos = await res.json();
    const container = document.getElementById("lista-agendamentos");
    container.innerHTML = "";

    if(agendamentos.msg){
        const div = document.createElement("div");
        div.className = "alert alert-info";
        div.textContent = agendamentos.msg;
        container.appendChild(div);
        return;
    }

    agendamentos.forEach(a=>{
        const card = document.createElement("div");
        card.className = "card agendamento-card";
        card.innerHTML = `
            <div class="card-body">
                <div class="agendamento-data">${a.data} <span class="agendamento-hora">${a.hora}</span></div>
                <div>Cliente: <strong>${a.cliente}</strong> - Telefone: ${a.telefone}</div>
                <div>Barbeiro: <span class="agendamento-barbeiro">${a.barbeiro}</span></div>
            </div>
        `;
        container.appendChild(card);
    });
}

// Carrega agendamentos na inicialização
carregarAgendamentos();
</script>
</body>
</html>
